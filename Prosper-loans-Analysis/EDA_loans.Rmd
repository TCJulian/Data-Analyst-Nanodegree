# Exploratory Data Analysis: Prosper Loan Dataset
_by Tyler Julian_
_Last Updated: 3/16/2018_

========================================================

## Abstract

In the finance, everyone is looking at getting the best deal. Best interest rate, best return, low risk and high reward... as both borrowers and lenders, we want it all. This primarily takes form in the interest rate of a loan. Unfortunately, the interest rate that borrowers want and what lenders want do not always line up. Even worse is trying to understand the factors that determine the interest rate to being with. For borrowers, credit score is considered the most popular variable, but what other factors impact the loans? The amount of the loan? Where you live? How much income you have? This project hopes to explore some of these trends in a real-life dataset and reveal the biggest factors that influence a borrower's interest rate.

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load packages

library(dplyr)
library(ggplot2)
library(gridExtra)
library(RColorBrewer)
library(tidyr)
```

```{r echo=FALSE, Load_the_Data}
# link to dataset reference: https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0

loans <- read.csv('prosperLoanData.csv')
```

## Data Source

This dataset contains loan data from [_Prosper_](https://www.prosper.com/personal-loans/better-finances/?refac=GoogSearch&refmc=BorGenAcq&refd=cm:SEM-Brand%7C%7Cag:29761763651%7C%7Ckw:prosper%20loans%7C%7Cad:233096998244%7C%7Cdv:c%7C%7Cmt:e%7C%7Cap:1t1&gclid=EAIaIQobChMI9_O45P3z2AIV2AuBCh1i3QacEAAYASAAEgItg_D_BwE&flags=BetterFinancesLandingPage:WithoutLoanAmount), an online marketplace that brings investors and borrowers together to fund small to medium sized loans. Borrowers can get loans up to $35,000, with the interest rates set by Propser. Lenders get to choose what loans they want to fund, with higher risk loans providing a higher return.

The dataset can be downloaded from this project's [GitHub repository](https://github.com/TCJulian/Data-Analyst-Nanodegree/tree/master/Prosper-loans-Analysis).

## Initial Exploration

A logical start to understanding this dataset would be to look at its shape and variables.

```{r, echo=FALSE, Shape_loans}
dim(loans)
```

The dataset contains 113,937 observations from 81 different variables.

Let's look at a sample of those variables:

```{r, echo=FALSE, Variables_loans}
head(colnames(loans), 10)
```

There are a multitude variables in this dataset, some of whose meaning may not be intuitive at first glance. This [reference](https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0), adapted from the _Prosper_ API, provides context to each of the variables. 

## Univariate Analysis

### Borrower Interest Rate

One of most important variables for both a borrower and a lender is the interest rate of the loan. The interest rate is ultimately set by _Prosper_ and is decided based upon by a variety of variables.

```{r echo=FALSE, BorrowerRate_Histogram}

ggplot(loans, 
       aes(x = BorrowerRate * 100)) + 
  geom_histogram(binwidth = 1, 
                 fill = "#598BF7", 
                 color = "black") +
  labs(x = "Borrower Interest Rate (%)", 
       y = "Count",
       title = "Borrower Interest Rate Histogram")
```

The interest rate curve seems to be slightly right skewed, with an abnormal spike at 32%. This could be because of overlapping binwidths. Lets graph `BorrowerRate` again, but with 0.5 binwidths to investigate:

```{r echo=FALSE, BorrowerRate_Investigate}

ggplot(loans, 
       aes(x = BorrowerRate * 100)) + 
  geom_histogram(binwidth = 0.5, 
                 fill = "#598BF7", 
                 color = "black") +
  labs(x = "Borrower Interest Rate (%)", 
       y = "Count", 
       title = "Borrower Interest Rate Histogram (bw = 0.5)")
```

Unfortunately, it seems binwidth is not the answer. 32% still has an extremely high appearance count. At the moment, there appears to be no answer as to why this rate occurs so frequently. One option would be to explore a subset of the dataset that only had 32% interest rate users and compare them with the entire population for differences. However, that is beyond the scope of this analysis, as there are other variables to explore.

### Average Credit Score

As one of the most well known indicators of an individual's financial credibility, Credit Score is the most basic requirement for getting a loan. 

This dataset does not provide a singular credit score, but rather a range. The two variables, `CreditScoreRangeLower` and `CreditScoreRangeUpper`, store the upper and lower bounds of a user's credit score. To visualize the data properly, the two ranges need to be combined into an average. The newly created variable will be named `CreditScoreAverage`.

```{r, echo=FALSE, warning=FALSE, Create_CreditScoreAverage}
# Create average credit score column in dataset
loans <- mutate(loans, 
                CreditScoreAverage = round((CreditScoreRangeLower + 
                                            CreditScoreRangeUpper) / 2))
summary(loans$CreditScoreAverage)
```

With a mean of 695.6 and a median of 690, the central tendency of the distribution seems to be consistent. There are 591 NA's in the data and the 1st and 3rd quartiles are within expectations. However, the minimum value seems way off the charts in terms of its distance from the rest of the data. Let's plot the data to get a better understanding of its shape.

```{r, echo=FALSE, message=FALSE, AvgCreditScore_Histogram}
# Initial plot with low outliers and no NAs
ggplot(data = subset(loans, !is.na(loans$CreditScoreAverage)), 
       aes(x = CreditScoreAverage)) +
  geom_histogram(fill = "#598BF7", 
                 color = "black") +
  labs(x = "Average Credit Score", 
       y = "Count",
       title = "Average Credit Score Histogram")
```

There seems to be a handful of credit scores close to zero. Because these scores are abysmally low and are no where near the rest of the distribution, they are marked as outliers. With this new knowledge, the data is plotted again with smaller binwidths, better breaks, and without the outliers.

```{r echo=FALSE, warning=FALSE, AvgCreditScore_Outliers}
# Plot without outlier and proper breaks
ggplot(data = subset(loans, !is.na(loans$CreditScoreAverage)), 
       aes(x = CreditScoreAverage)) +
  geom_histogram(binwidth = 20, 
                 fill = "#598BF7", 
                 color = "black") +
  scale_x_continuous(limits = c(440, 900), 
                     breaks = c(seq(440, 900, 40))) +
  labs(x = "Average Credit Score", 
       y = "Count",
       title = "Average Credit Score Histogram")
```

After those adjustments, the data now has a semi-bell curve. From 680 to 900, the shape of the plot is almost perfect in terms of being normal. From 440 to 680, it has more deviation, but still follows a normal shape.

This plot follows the initial intuition about credit score. It makes sense that most people fall right in the middle of the ranges, with a majority of the scores floating around the average score of 700. You have a smaller subset of people that maybe haven't been up to date on payments or have defaulted, leading to very poor scores. There is also another subset of people who are maybe very diligent about their payments, resulting in high scores. 

### Income

Many lenders also look at a borrower's income when determining whether to fund a loan. A borrower with more disposable income should be more likely to pay their monthly payments on a loan and are thus considered a less risky investment. 

Income for borrowers is stored in the variable `IncomeRange`:

```{r, echo=FALSE, IncomeRange_str}
str(loans$IncomeRange)
```

`str(IncomeRange)` shows that income is factored into levels:

```{r, echo=FALSE, IncomeRange_levels}
levels(loans$IncomeRange)
```

Two things to note:

1. The levels are not ordered.
2. Some of the levels can be combined.  
  
For this analysis, the values need to be be ordered from least to greatest. This will provide a much more organized plot and move the data type from nominal to ordinal. The levels `Not employed` and `$0`, while still technically having different meanings, both represent that the buyer does not have a primary career that provides income. As a result, these two levels be combined to reduce the complexity of the variable.
  
```{r, echo=FALSE, Income_relevel}
# Order levels
loans$IncomeRange <- factor(loans$IncomeRange, 
                            levels = c("Not displayed", "Not employed", 
                                       "$0", "$1-24,999", 
                                       "$25,000-49,999", "$50,000-74,999", 
                                       "$75,000-99,999", "$100,000+"),
                            ordered = TRUE)

# Combine "Not employed" with "$0" 
levels(loans$IncomeRange) <- c("Not displayed", "$0", 
                               "$0", "$1-24,999", 
                               "$25,000-49,999", "$50,000-74,999", 
                               "$75,000-99,999", "$100,000+")

# Return new levels
levels(loans$IncomeRange)
```

Now that the levels have been properly transformed, the non-NA data can be visualized as a barchart:

```{r, echo=FALSE, Income_Bar}
# Plot barchart without NAs
ggplot(data = subset(loans, loans$IncomeRange != "Not displayed"),
       aes(x = IncomeRange)) +
  geom_bar(fill = "#598BF7",
           color = "black") +
  labs(x = "Income Range ($)",
       y = "Count", 
       title = "Income Ranges of Borrowers")
```

Or as a table:

```{r, echo=FALSE, Income_table}
table(loans$IncomeRange)
```

`IncomeRange` shows that most borrowers have income that falls within two bins: `$25,000-49,999` and `$50,000-74,999`. There are more borrowers that fall above these ranges than below them. This might suggest that borrowers with higher reported incomes are more likely to take out a loan than those with lower reported incomes. More exploration combined with other variables is required to validate this theory.

### Stated Monthly Income

Monthly income is very similar to income range. The biggest and most important difference is that this variable is quantitative rather than qualitative.

```{r, echo=FALSE, Monthly_Income_summary}
summary(loans$StatedMonthlyIncome)
```
There is a very large outlier in dataset with one individual claiming to bring in almost 2 million dollars every month. The top 1% of the data will be removed so the distribution can be more clearly viewed.

```{r, echo=FALSE, warning=FALSE, Monthly_Income_plot}
ggplot(data = loans,
       aes(x = StatedMonthlyIncome)) +
  geom_histogram(fill = "#598BF7",
                 color = "black", 
                 binwidth = 500) +
  lims(x = c(0, quantile(loans$StatedMonthlyIncome, prob=(.99)))) +
  labs(x = "Monthly Income ($)",
       y = "Count", 
       title = "Monthly Income of Borrowers")
```

The Monthly Income distribution is skewed right with most individuals making about $4750.

### Debt to Income Ratio

Debt to income ratio, stored as `DebtToIncomeRatio`, is exactly what it sounds like: a borrower's debt divided by their current income at the time the credit profile was pulled. 

```{r, echo=FALSE, DebtIncomeSummary}
str(loans$DebtToIncomeRatio)
summary(loans$DebtToIncomeRatio)
```

A quick look at the summary and structure of the variable shows that the median ratio is 0.22, while the mean is a bit higher at 0.276. The maximum is incredibly high, showing a debt to income ratio of over 1000%. A quick look at the variable reference page shows that 10.01 is the highest ratio able to be recorded.

In order to deal with these potential outliers, the top 1% of values is excluded from the resulting plot:

```{r echo=FALSE, warning=FALSE, DebtIncome_Histogram}
ggplot(loans, aes(x = DebtToIncomeRatio)) +
  geom_histogram(binwidth = 0.025, 
                 fill = "#598BF7", 
                 color = "black") +
  scale_y_continuous(breaks = c(seq(0, 11000, 1000))) +
  scale_x_continuous(breaks = c(seq(0, 1, 0.1)), 
                     limits = c(0, quantile(loans$DebtToIncomeRatio, 
                                            probs = 0.99, 
                                            na.rm = TRUE))) +
  labs(x = "Debt/Income Ratio", 
       y = "Count", 
       title = "Debt to Income Ratio Histogram")
  
```

The distribution of debt to income seems to be slightly right skewed with a long tail. There are small peaks at all of the 0.5 breaks, which might suggest that the data was rounded upon retrieval. The right skew would explain the higher mean than the median. It makes intuitive sense that the majority of individuals have a low debt to income ratio on average, with the count decreasing as the debt to income ratio climbs higher. It becomes increasingly hard to live as the debt to income ratio increases.

### Term Length

Term length is the length of time the loan has until it has to be paid off. A longer term length means the borrowers have to pay less per month, but perhaps more interest over the life of the loan.

```{r echo=FALSE, TermLength_Unique}
unique(loans$Term)
```

Looking at only the unique values of `Term`, the only terms offered by _Prosper_ are 12, 36, and 60 term lengths. The API shows that this variable is measured in months. 

The `Term` variable currently has no levels, but can be easily factored since there are so few unique values. Once factored, `Term` can be displayed as a table.

```{r, echo=FALSE, TermLength_Factored}
loans$Term <- factor(loans$Term, levels = c(12, 36, 60), ordered = TRUE)
```

```{r, echo=FALSE, TermLength_Table}
table(loans$Term)
```

```{r echo=FALSE, TermLength_Bar}
ggplot(data = loans, aes(x = Term)) +
  geom_bar(fill = "#598BF7", 
           color = "black") +
  labs(x = "Term Length (months)", 
       y = "Count", 
       title = "Term Length")
```

It appears that the vast majority of loans have a term length of 36, accounting for 77% of all loans. Term lengths of 60 make up most of the remaining loans, with 12 month terms only accounting for 1.4% of all loans.

### Estimated Return

For lenders, how much return they receive from their investment is a very important factor when choosing which loans to fund. _Prosper_ has a variable for this value, `EstimatedReturn`, displayed as a percentage. This variable is calculated by taking the difference from a loan's `EstimatedEffectiveReturn` and `EstimatedLoss`. Both of these variables can be found in detail from the variable [reference page](https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0).

```{r, echo=FALSE, EstimatedReturn_Summary}
summary(loans$EstimatedReturn)
```

A summary shows that the average expected return is around 9.5%. This is slightly higher than [6.7% average total return](https://www.prosper.com/invest) listed on their website. There are also a lot of NAs for this particular variable, probably attributable to the fact that this variable wasn't be tracked until the start of July 2009.

```{r, echo=FALSE, warning=FALSE, EstimatedReturn_Histogram}

ggplot(loans, aes(x = EstimatedReturn * 100)) +
  geom_histogram(binwidth = 1, 
                 fill = "#598BF7", 
                 color = "black") +
  scale_x_continuous(limits = c(-10, 30), 
                     breaks = c(seq(-10, 30, 5))) +
  labs(x = "Estimated Return (%)", 
       y = "Count)", 
       title = "Estimated Return Histogram")
```

The distribution appears to be approximately normally distributed. However, some of the values seem to have very high counts, which makes it much harder to see the data in the tails. By scaling the y-axis by square roots, the tails should be easier to see.

```{r echo=FALSE, warning=FALSE, EstimatedReturn_yscaled}
ggplot(loans, aes(x = EstimatedReturn * 100)) +
  geom_histogram(binwidth = 1, 
                 fill = "#598BF7", 
                 color = "black") +
  scale_x_continuous(limits = c(-10, 30), 
                     breaks = c(seq(-10, 30, 5))) +
  scale_y_sqrt(breaks = c(100, 1000, 2500, 5000, 10000, 12000)) +
  labs(x = "Estimated Return (%)", 
       y = "sqrt(Count)", 
       title = "Estimated Return Histogram")
```

Now the tails are much easier to see. The distribution does indeed remain approximately normally distributed, with the peak right around the mean and median. Most of the estimated returns are positive. 

```{r, echo=FALSE, EstimatedReturn_positive }
length(loans$EstimatedReturn[loans$EstimatedReturn > 0]) / length(loans$EstimatedReturn)
```

In fact, over 99% of all loans through _Prosper_ have a positive estimated return. From a lender standpoint, this is excellent news. However, estimations do not always live up to reality.

### Borrower State

`BorrowerState` is exactly what it sounds like: the state the borrower currently resides in when acquiring the loan.

```{r, echo=FALSE, BorrowerState_str}
str(loans$BorrowerState)
```

The structure of the variable shows that each state is treated as its own level. 

```{r echo=FALSE, BorrowerState_Bar, fig.width = 12, fig.height=4}
ggplot(subset(loans, loans$BorrowerState != ''), (aes(x = BorrowerState))) +
  geom_bar()
```

Quickly plotting the variable shows that the levels need to be reordered if they are going to be visualised in a bar chart.

```{r, echo=FALSE, BorrowerState_Order}
loans$BorrowerState <- factor(loans$BorrowerState, level = names(sort(table(loans$BorrowerState), decreasing = TRUE)))
```

```{r echo=FALSE, BorrowerState_OrderedBar, fig.width = 12, fig.height=4}
ggplot(data = subset(loans, loans$BorrowerState != ''), 
       (aes(x = BorrowerState))) +
  geom_bar(fill = "#598BF7", 
           color = "black") +
  labs(x = "States", 
       y = "Count", 
       title = "Borrowers by State")
```

California appears to have much more borrowers than any other state. This is understandable sense [_Prosper_ was founded in San Francisco California](https://www.prosper.com/plp/about/contact-us/). The states following California--Texas, New York, Florida--are also metro hubs with large tech industries.

### Credit Grade and Prosper Rating

In an effort to make investments easier to assess for potential investors, _Prosper_ created the "CreditGrade" scoring system. This was eventually replaced with the "Prosper Rating" system in 2009, which is very similiar to CreditGrade. In order toanalyze these variables throughout all of the data, these two variables need to be combined into one. 

```{r, echo=FALSE, Rating_levels}
levels(loans$CreditGrade)
levels(loans$ProsperRating..Alpha.)
```
 
Looking at the levels of the two variables, Credit Grade has an extra level called `NC`. The rest of both levels are the same. It is also important to note that the variables have no `NA` values. Rather, they are input as "". 
 
```{r, echo=FALSE, Rating_summary }
summary(loans$CreditGrade)
summary(loans$ProsperRating..Alpha.)
```

In order to manipulate these variables effectively, the "" values need to be substituted with `NA`. Once the "" values transformed into NA's, `ProsperRatings` and `CreditGrade` can be combined into a single column and ordered from the lowest ratings to the highest rating.
 
```{r, echo=FALSE, Rating_combine}
# Remove NAs from CreditGrade and ProsperRating
loans$ProsperRating..Alpha.[loans$ProsperRating..Alpha. == ""] <- NA
loans$CreditGrade[loans$CreditGrade == ""] <- NA

# Combining Credit Grade and Prosper Rating into loans$ratings
loans$ratings <- loans$CreditGrade
loans$ratings[!is.na(loans$ProsperRating..Alpha.)] <- loans$ProsperRating..Alpha.[!is.na(loans$ProsperRating..Alpha.)]

loans$ratings <- factor(loans$ratings, 
                        levels = c('NC', 'HR', 'E', 'D', 'C', 'B', 'A', 'AA'))
```

```{r, echo=FALSE, Ratings_Bar}
ggplot(subset(loans, !is.na(loans$ratings) & loans$ratings != "NC"), 
       aes(x = ratings)) +
  geom_bar(fill = "#598BF7",
           color = "black") +
  labs(x = "Credit Rating", 
       y = "Count", 
       title = "Credit Rating Bar Chart")
```

The plot for combined Credit rating turns out very well. The data appears normally distributed with the `C` rating having the most values. The highest rating, `AA`, has the least amount of values.

### Loan Status

Each loan has a loan status associated with it. This determines whether the current loan has been completed, whether it is late on its payments, or whether it has been defaulted on.

```{r echo=FALSE, LoanStatus_Levels}
levels(loans$LoanStatus)
```

Currently, there is a lot of detail in the levels. However, the granularity of the data can be reduces by combining some of the levels. More specifically, some of the `Past Due` bins can be combined. `FinalPaymentInProgress` loans can also be lumped with `Current` loans.

Once the categorical bins have been combined, the levels can also be ordered from the most favorable status to the least favorable status.

```{r echo=FALSE, LoanStatus_Relevel}
# Combine "Past Due" levels
levels(loans$LoanStatus) <- c("Cancelled", "Chargedoff", "Completed", "Current",
                              "Defaulted", "Current", 
                              "PastDue (>30 days)", "PastDue (1-30 days)", 
                              "PastDue (1-30 days)", "PastDue (>30 days)", 
                              "PastDue (>30 days)", "PastDue (>30 days)")

loans$LoanStatus <- factor(loans$LoanStatus, 
                            levels = c("Completed", "Current", "PastDue (1-30 days)", "PastDue (>30 days)", "Defaulted", "Chargedoff", "Cancelled"))
```

```{r echo=FALSE, LoanStatus_Histogram, fig.width=8}
ggplot(data = subset(loans, loans$LoanStatus != 'Cancelled'), 
       aes(x = LoanStatus)) +
  geom_bar(fill = "#598BF7",
           color = "black") +
  labs(x = "Status", 
       y = "Count", 
       title = "Loan Status Histogram")
```

```{r echo=FALSE, LoanStatus_Table}
table(loans$LoanStatus)
```

A vast majority of the loans are either completed or active with up-to-date payments. However, there is also a large minority of loans that either go into default or are chargedoff. These negative results account for approximately 15% of all loans from Prosperity.

### Loan Amount

Loan amount is the total amount of cash given to the borrower once the loan is approved. Loans start at \$1,000 and go up to a maximum of \$35,000.

```{r echo=FALSE, LoanAmount_Histogram}
ggplot(data = loans, aes(x = LoanOriginalAmount)) +
  geom_histogram(binwidth = 1000,
                 fill = "#598BF7",
                 color = "black") +
  scale_x_continuous(breaks = c(seq(0, 35000, 5000))) +
  labs(x = "Loan Amount ($)",
       y = "Count",
       title = "Loan Amount Histogram")
```

```{r echo=FALSE, LoanAmount_summary}
summary(loans$LoanOriginalAmount)
```

The loan amount data is right skewed with multi-modal peaks. These peaks are all at the \$5,000 increments, which is probably attributable to the fact most people get loans at even amounts. 75% of the loans are $12,000 or less, with only a handful of loans at the maximum amount of \$35,000.

### Employment Status

Another common metric requested from lenders is the borrower's current employment status. Employment status gives the lender a gauge on the potential cashflow the borrower currently has. More cashflow usually represents a safer loan.

```{r, echo=FALSE, EmploymentStatus_levels}
levels(loans$EmploymentStatus)
```

Currently, the levels are not ordered and are listed nominally. `Not available` and `""` basically represent the same idea and can be combined.

To better analyse the variable, the levels will be ppoperly ordered and the two levels mentioned earlier will be combined.

```{r echo=FALSE, EmploymentStatus_relevel}
levels(loans$EmploymentStatus) <- c("Not available", "Employed", "Full-time", 
                                    "Not available", "Not employed", "Other", 
                                    "Part-time", "Retired", "Self-employed")

loans$EmploymentStatus <- factor(loans$EmploymentStatus, 
                                 levels = c("Employed", "Full-time", 
                                            "Part-time", "Self-employed",
                                            "Retired", "Not employed",
                                            "Other", "Not available"))
```

```{r echo=FALSE, EmploymentStatus_Bar}
ggplot(data = subset(loans, loans$EmploymentStatus != "Not available"),
       aes(x = EmploymentStatus)) +
  geom_bar(fill = "#598BF7",
           color = "black") +
  labs(x = "Employment Status",
      y = "Count",
      title = "Employment Status")
```

Most borrowers are employed in some manner. Very few report being unemployed.

### Employment Duration

Along with employment status, lenders also consider the borrower's employment duration. Longer durations usually signify more stable income, and thus a safer investment.

```{r, echo=FALSE, EmploymentStatusDuration_summary}
summary(loans$EmploymentStatusDuration)
```

A summary of the variable as well as the _Prosper_ API confirm that `EmploymentStatusDuration` is measured in months. The variable will be viewed in years for the following plots, as years are much easier to visualize and understand.

```{r echo=FALSE, EmploymentStatusDuration1}
ggplot(data = subset(loans, !is.na(loans$EmploymentStatusDuration)), 
       aes(x = EmploymentStatusDuration / 12)) +
  geom_histogram(binwidth = 1,
                 fill = "#598BF7",
                 color = "black") +
  scale_x_continuous(breaks = c(seq(0, 65, 5))) +
  labs(x = "Number of Years Employed",
       y = "Count", 
       title = "Employment Duration Histogram")
```
```{r echo=FALSE, EmploymentStatusDuration2}
summary(loans$EmploymentStatusDuration / 12)
```

The initial plot shows that the data is right skewed and unimodal. There is a long tail with some values way beyond the 3rd quartile. 50% of borrowers have employment durations between two and five 1/2 years.

### Summary of Univariate Analysis

The dataset consists of 83 variables with 113,937 observations.

__The variables of interest in this analysis are:__

  1. Interest Rate
  2. Average Credit Score
  3. Income
  4. Debt/Income Ratio
  5. Term Length
  6. Estimated Return
  7. Borrower State
  8. Borrower Rating
  9. Loan Status
  10. Loan Amount
  11. Employment Status
  12. Employment Duration
  
__Some of the more important observations:__

 * The interest rate distribution was slightly right skewed, with a abnormal peak at 32%.
 * The average credit score was 690.
 * Most loans had terms of 32 months.
 * Borrower ratings was normally distributed, with most loans being rated as a 'C'.
 * The average borrower was employed for 5.5 years and made between /$50,000 and /$75,000.
  
The main feature of interest in this dataset is the borrower's interest rate. Remember that the goal is to make a model that can predict the interest rate of Prosper loan, given some list of variables.

There are several variables that can be explored further that could potentially predict the interest rate a borrower has. Obviously `Average Credit Score` will be used. `Income`, `Loan Amount`, `Employment Duration/Status`, and `Debt/Income Ratio` all might be correlated with interest rate as well, and will definitely appear in the bivariate analysis. The `Borrower Rating` is another interesting variable to explore, especially with some of the other supporting variables.

In this analysis, there were also several variables that were adapted so they could be properly used. `Income`, `Term Length`, `Loan Status`, `Borrower State`, and `Employment Status` all had thier levels added, combined, or reordered. One new variable, `Rating`, was recreated entirely using the two other rating variables.  

# Bivariate Exploration

### Interest Rate vs. Average Credit Score

A borrowers credit score is widely known as being the biggest factor in determining the interest rate of a loan. Considering that,  it will be the first variable paired with interest rate.

```{r echo=FALSE, warning=FALSE, AvgCreditScore_BorrowerRate}
ggplot(loans, aes(x = CreditScoreAverage, y = BorrowerRate)) +
  geom_point(alpha = 0.1) +
  scale_x_continuous(limits = c(400, 900), breaks = c(seq(400, 900, 50))) +
  ylim(0, 0.4) +
  labs(x = 'Average Credit Score', 
       y = 'Interest Rate',
       title = "Interest Rate by Average Credit Score")
```

Because of the way credit scires were recorded by _Prosper_, the credit scores all lie along similiar x's, formed buckets of data. By adding some horizontal jitter, a better shape can be formed.

```{r echo=FALSE, warning=FALSE, AvgCreditScore_BorrowerRate_jitter}
ggplot(loans, aes(x = CreditScoreAverage, y = BorrowerRate)) +
  geom_point(alpha = 0.1,
             position = position_jitter(w = 9)) +
  scale_x_continuous(limits = c(400, 900), breaks = c(seq(400, 900, 50))) +
  ylim(0, 0.4) +
  labs(x = 'Average Credit Score', 
       y = 'Interest Rate',
       title = "Interest Rate by Average Credit Score")
```

At first glance, it seems as if there might be a slight downward trend through the data. As credit score increases, the interest rate seems to decrease. 

```{r, echo=FALSE, CreditScore_BorrowerRate_cor}
cor(loans$CreditScoreAverage, loans$BorrowerRate, use = "complete.obs")
```

A short correlation test support this theory, reporting a moderate negative correlation between average credit score and interest rate. 

```{r, echo=FALSE, CreditScore_BorrowerRate_lm}
cs_ir <- lm(BorrowerRate ~ CreditScoreAverage, data=loans)
summary(cs_ir)
```

While there is a correlation between this variable, average credit score only explains 21.3% of the variance in interest rate.

With this first variable, the underlaying factors that may predict the interest rate of a loan are coming to the surface. However, credit score was an obvious first choice. What other variables in tandem with credit score might provide us with a strong predictor?

### Interest Rate vs. Loan Amount

The intuition that the size of the loan might impact interest rate makes sense. As the size of the loan goes up, lenders might require that the borrowers are more trust worthy and have less risk than an low sized loan.

```{r echo=FALSE, LoanAmount_BorrowerRate}
ggplot(loans, aes(x = LoanOriginalAmount, y = BorrowerRate)) +
  geom_point(alpha = 0.25) 
```

```{r echo=FALSE, LoanAmount_BorrowerRate_jitter}
ggplot(loans, aes(x = LoanOriginalAmount, y = BorrowerRate)) +
  geom_point(alpha = 0.25, 
             size = 0.6,
             position = position_jitter(width = 0.25)) +
  scale_x_continuous(breaks = c(seq(0, 35000, 5000))) +
  labs(x = "Loan Amount ($)", 
       y = "Interest Rate", 
       title = "Interest rate by Loan Amount")
```

```{r, echo=FALSE, LoanAmount_BorrowerRate_cor}
cor(loans$LoanOriginalAmount, loans$BorrowerRate, use = "complete.obs")
```

The scatterplot and the correlation test both support this theory. The small negative correlation means that as the size of the loan increases, the interest rate on average decreases a little as well. 
 
However, it is importatnt to not attribute correlation with causation, and to be aware lurking variables may be present. Higher is loans may have low interest rates because only people with secure financial portfolios can afford them.
 
### Interest Rate vs. Rating

The rating of a loan is the snapshot of a borrowers riskiness at _Prosper_. I suspect that there might be a relationship between the rating of a loan and its interest rate.

```{r echo=FALSE, Rating_BorrowerRate}
ggplot(subset(loans, !is.na(loans$ratings) & loans$ratings != "NC"), 
       aes(x = ratings, y = BorrowerRate)) + 
  geom_boxplot() +
  labs(x = "Ratings",
       y = "Interest Rate",
       title = "Interest Rate by Ratings")
```

There is clearly a strong relationship between interest rate and ratings; in fact it is the strongest we have seen so far. The difference between the median of the lowest rating and the highest rating is almost 25%! It could be that rating is tied to other variables that are correlated with interest rate, such as credict score or the amount of the loan. Regardless, this is definitely a varible that could be used to predict the interest rate of a loan.

### Interest Rate vs. Income

It would make sense that individuals who have more cash flow are rewarded with lower interest rates, since it is more likely they will be able to pay their bills and thus will be a low risk loan.

```{r echo=FALSE, InterestRate_Income}
ggplot(data = loans,
       aes(x = IncomeRange, y = BorrowerRate)) +
  geom_boxplot() +
  labs(x = "Income Range ($)",
       y = "Interest Rate",
       title = "Interest Rate by Income Range")
```

```{r echo=FALSE, warning=FALSE, InterestRate_DebtIncomeRatio}
ggplot(data = loans,
       aes(x = StatedMonthlyIncome, y = BorrowerRate)) +
  geom_point(alpha = 0.1, size = 1) +
  lims(x = c(0, quantile(loans$StatedMonthlyIncome, probs=(0.99)))) +
  labs(x = "Monthly Income ($)",
       y = "Interest Rate",
       title = "Interest Rate by Monthly Income")
```

```{r, echo=FALSE, BorrowerRate_MonthlyIncome_corr}
cor(loans$StatedMonthlyIncome, loans$BorrowerRate, use = "complete.obs")
```

There does appear to be a relationship between income and interest rate, but it is not very strong. Borrowers with more income do on average have lower interest rates, with each range having a slightly lower interest rate than the previous. Stated monthly income follows a similar pattern, but further shows how weak the correlation is.  

These findings was surprising. I expected income to be correlated much more highly with interest rate. It could be because income can fluctuate greatly from month to month, and sometimes isn't verifiable. 

### Interest Rate vs. Borrower State

Where someone lives in the United States can usually have a profound impact on someones financials, due to cost of living, taxes, etc. Do interest rates also fluctuate in that same pattern? 

```{r echo=FALSE, InterestRate_BorrowerState, fig.height=5, fig.width=11}
ggplot(data = subset(loans, BorrowerState != ""),
       aes(x = BorrowerState, y = BorrowerRate)) +
  geom_boxplot() +
  geom_hline(yintercept = 0.184, 
             color = "red") +
  lims(y = c(0, 0.4)) +
  labs(x = "Borrower State",
       y = "Interest Rate",
       title = "Interest Rate by Borrower State")
```

This inital plot shows that interest rate does not differ between states for the most part. The horizontal red line is the median interest rate. Overall, there are slight deviations between the medians, but they all still lie close to the overall median interest rate. A few of the states that deviate the most are Maine, Iowa, Alabama, and Washington DC, however they also have a much lower smaple size and may have more variance.

### Interest Rate vs. Employment

Employment history and duration are other important metrics that might trend with interest rate.

```{r echo=FALSE, InterestRate_EmploymentStatus}
ggplot(data = loans,
       aes(x = EmploymentStatus, y = BorrowerRate)) +
  geom_boxplot() +
  labs(x = "Employment Status",
       y = "Interest Rate",
       title = "Interest Rate by Employment Status")
```

For the most part, employment status does not seem too related to interest rate. Reporting as "Not employed" seems to be the only response that may be related to a higher interest rate. 

```{r echo=FALSE, warning=FALSE, InterestRate_EmploymentDuration}
ggplot(data = loans,
       aes(x = EmploymentStatusDuration / 12, y = BorrowerRate)) +
  geom_point(alpha = 0.2, size = .5) +
  lims(y = c(0, 0.4)) +
  labs(x = "Employment Duration (years)",
       y = "Interest Rate",
       title = "Interest Rate by Employment Duration")
```

```{r}
cor(loans$BorrowerRate, loans$EmploymentStatusDuration, use = "complete.obs")
```

Unfortunately, there also does not seem to be any correlation between employment duration and interest rate, which I find surprising.

# Bivariate Reflection

The bivariate section definitly shed some light into the relationships between interest rate and some of the other variables. Interest rate seems to be tied to credit score, though it does not account for a large portion of its variance, based on it's R^2 value. Surprisingly, interest rates did not fluctate much between different states, even though cost of living is different amongst each of them.

The strongest relationships for interest rate were with average credit score and ratings, while the weakest relationships were with  employment duration, employment status, and income.

# Multivariate Analysis

### Interest Rate by Rating Density Plot
```{r echo=FALSE, warning=FALSE, BorrowerRate_Rating_density}
ggplot(data = subset(loans, ratings != 'NC' & !is.na(ratings)),
       aes(x = BorrowerRate*100, color = ratings)) +
  geom_density(size = 1) +
  lims(x = c(0, 40)) +
  scale_color_brewer(palette = "Blues") +
  guides(color = guide_legend(reverse=T)) + 
  labs(x = "Interest Rate",
       y = "Density",
       title = "Density Plot of Interest Rate by Rating") +
  theme(panel.background = element_rect(fill = '#AAAAAA'),
        panel.grid.major = element_line(color = '#878787'),
        panel.grid.minor = element_line(color = '#878787')) 
```

This visualization really shows how each rating corresponds with a specific range of interest rates. The highest rating "AA" peaks at the low end of the interest rates. The rating under that, "A", peaks at a little higher interest rate. As you move down the tier list, the interest rates peak at higer and higher interest rates, with the High Risk accounts peaking at the 32% mark.

### Loan Amount vs. Interest Rate by Rating

```{r echo=FALSE, warning=FALSE, LoanAmount_BorrowerRate_Rating, fig.height=5, fig.width=10}
ggplot(data = subset(loans, ratings != 'NC' & !is.na(ratings)), 
       aes(x = LoanOriginalAmount, y = BorrowerRate, color = ratings)) +
  geom_point(alpha = 0.5) +
  scale_x_sqrt(breaks = c(0, 1000, 2500, 5000, 10000, 15000, 20000, 25000, 30000, 35000)) + 
  scale_color_brewer(palette = "RdBu") + 
  labs(x = "Original Loan Amount ($)", 
       y = "Interest Rate",
       title = "Interest rate vs. Loan Amount by Rating") +
  theme(panel.background = element_rect(fill = '#AAAAAA'),
        panel.grid.major = element_line(color = 'grey'),
        panel.grid.minor = element_line(color = 'grey')) 
```

This plot does show the small correlation between rating and loan amount. Most of the high risk loans are for smaller loans less than $5,000. The higher loan amount have almost no high risk accounts and only "C" or higher ratings

### Average Credit Score vs. Interest Rate by Rating

```{r echo=FALSE, warning=FALSE, CreditScore_BorrowerRate_Rating, fig.height=5, fig.width=10}
ggplot(data = subset(loans, ratings != 'NC' & !is.na(ratings)), 
       aes(x = CreditScoreAverage, y = BorrowerRate * 100, color = ratings)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(limits = c(400, 900),
                     breaks = c(seq(400, 900, 50))) + 
  scale_color_brewer(palette = "RdBu") + 
  labs(x = "Credit Score", 
       y = "Borrower Interest Rate (%)",
       title = "Relationship between Interest Rate, Credit Score, and Rating") +
  theme(panel.background = element_rect(fill = '#AAAAAA'),
        panel.grid.major = element_line(color = 'grey'),
        panel.grid.minor = element_line(color = 'grey')) 
```

The inital coloring looks promising. However, due to the nature that of the method the credit scores were collected, jitter will be added to the plot, similiar to what was done in the univariate section.

```{r echo=FALSE, warning=False, CreditScore_BorrowerRate_Rating_jitter, fig.height=5, fig.width=10}
ggplot(data = subset(loans, ratings != 'NC' & !is.na(ratings)), 
       aes(x = CreditScoreAverage, y = BorrowerRate, color = ratings)) +
  geom_point(alpha = 0.5,
             position = position_jitter(w = 9)) +
  scale_x_continuous(limits = c(400, 900),
                     breaks = c(seq(400, 900, 50))) + 
  scale_color_brewer(palette = "RdBu") + 
  lims(y = c(0, 0.4)) +
  labs(x = "Credit Score", 
       y = "Interest Rate",
       title = "Interest Rate vs.Credit Score by Rating") +
  theme(panel.background = element_rect(fill = '#AAAAAA'),
        panel.grid.major = element_line(color = 'grey'),
        panel.grid.minor = element_line(color = 'grey')) 
```

I believe that this plot perfectly captures the relationship between interest rates, credit score, and ratings. The lower, less risk accounts with a high credit score get teh best rating by _Propser_ and thus the lowest interest rate. As the credit score decreases, the average interest rate increases and the ratings begin to change. There is a nice progression of the ratings as both t interest rate increases and the credit score decreases.

------

# Reflection

Overall, this was a very interesting and enlightening dataset to explore. It was really surprising to me how impactful credit score was on interest rate, and how negligible income, locale, and employment were. Perhaps some of those other variables are used to determing whether a borrower can get a loan to begin with rather than what there interest rate will be.

The hardest part of this project was sifting through the vast amount of variables. There are so many potential combinations of categorical and continuous variables that I might have missed some interesting trends. I sometimes found myself at a dead end in the later bi/multivariate sections, wishing that I could go back and add more variables without increasing the bulk of the project. I think in the future I will use more visualization tools to preview as much of the data as possible first before diving into analyzing multiple variables at once. That way, I can sift through the variables that have no trends and go straight to the more impactful relationships.

I definitely believe that more research can be done on this dataset. There are variables that I didn't explore due to the length of the project already. I would love to one day revisit this project and form a model that could accurately predict interest rate based off other variables like credit score or number of deliquent payments.






